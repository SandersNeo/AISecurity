# RLM Auto-Population Enhancement - Требования

## Проблема

Текущая скорость накопления фактов в RLM слишком медленная:
- **Discover** находит только структуру проекта (1 факт, 10 доменов)
- Факты добавляются только при явных вызовах `rlm_add_fact`
- Git Hook работает только при коммитах
- Нет автоматического извлечения из conversation history

## Цели

1. Увеличить скорость первоначального наполнения в **10x**
2. Автоматизировать извлечение фактов из разных источников
3. Сохранить качество фактов (precision > 80%)

---

## Функциональные требования

### FR-1: Deep Code Analysis (Discover v2)

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-1.1 | При `rlm_discover_project` извлекать архитектурные решения из README, docstrings, comments | HIGH |
| FR-1.2 | Парсить конфигурационные файлы (package.json, pyproject.toml, Dockerfile) | HIGH |
| FR-1.3 | Извлекать import graph для понимания зависимостей между модулями | MEDIUM |
| FR-1.4 | Определять паттерны проектирования (factory, singleton, decorator) | LOW |

### FR-2: Conversation History Extraction

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-2.1 | Автоматически извлекать решения из conversation history | HIGH |
| FR-2.2 | Детектировать паттерны: "решил использовать X потому что Y" | HIGH |
| FR-2.3 | Извлекать из commit messages при git hook | MEDIUM |

### FR-3: File Watcher Mode

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-3.1 | Опциональный watch mode для автоматического обновления при изменении файлов | MEDIUM |
| FR-3.2 | Debounce для избежания лишних обновлений | MEDIUM |
| FR-3.3 | Фильтр по расширениям (.md, .py, .ts, .json) | MEDIUM |

### FR-4: Improved Git Integration

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-4.1 | Извлекать факты из PR descriptions | MEDIUM |
| FR-4.2 | Парсить conventional commits для domain detection | HIGH |
| FR-4.3 | Batch processing для исторических коммитов | LOW |

---

## Нефункциональные требования

| ID | Требование | Метрика |
|----|------------|---------|
| NFR-1 | Discover v2 должен выполняться < 30 сек для проекта 10K LOC | Performance |
| NFR-2 | False positive rate < 20% | Quality |
| NFR-3 | Не блокировать UI во время extraction | UX |
| NFR-4 | Incremental updates (не пересканировать весь проект) | Performance |

---

## User Stories

### US-1: Быстрый старт проекта
> Как разработчик, я хочу чтобы RLM автоматически заполнился знаниями о проекте за первые 5 минут работы.

**Acceptance Criteria:**
- [ ] При открытии нового проекта RLM извлекает ≥20 фактов автоматически
- [ ] Факты категоризированы по L0-L3 уровням
- [ ] Домены созданы для каждого модуля

### US-2: Continuous Learning
> Как разработчик, я хочу чтобы RLM учился из моих решений без явного добавления фактов.

**Acceptance Criteria:**
- [ ] Решения из conversation автоматически становятся кандидатами на факты
- [ ] Пользователь может approve/reject кандидатов
- [ ] Approved факты сохраняются с source="conversation"

### US-3: Code Change Awareness
> Как разработчик, я хочу чтобы RLM обновлялся при изменении кода.

**Acceptance Criteria:**
- [ ] При изменении файла RLM обновляет связанные факты
- [ ] Устаревшие факты помечаются как stale
- [ ] Watch mode опционален и отключаем

---

## Вопросы для уточнения

1. Должны ли извлечённые факты автоматически approve или требовать подтверждения?
2. Какой приоритет у watch mode vs git hook?
3. Нужна ли интеграция с IDE events (file open, cursor position)?
